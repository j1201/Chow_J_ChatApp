// imports go at the top
import ChatMsg from'./components/ChatMessage.js';
import UserBar from'./components/UserInfo.js';
var socket = io();

// utility function for socket
function setUserID({ sID }) {
  // save our unique ID generated by Socket on the server side
  vm.socketID = sID;
}

// utility functions for socket
function addNewMessage(message) {
    vm.messages.push(message);
}

function handleTypingEvent(user) {
  console.log(user,'is typing');
}

const { createApp } = Vue

const vm = createApp({

    data() {
      return {
        socketID: '',
        message: '',
        messages: [],
        avatar: localStorage.getItem('selectedAvatar'),
        currentUser: localStorage.getItem('currentUser'),
        room: localStorage.getItem('room')
      }
    },

    methods: {
      userInfo() {
        localStorage.setItem('currentUser', this.currentUser);
        localStorage.setItem('room', this.room);
      },

      dispatchMessage() {
        console.log('send a message to the chat service');

        // data that sent to the server
        socket.emit('chat_message', { 
          content: this.message, 
          user: this.currentUser,
          id: this.socketID,
          img: this.avatar
        });

        this.message = '';
      },

      dispatchTypingEvent () {
        // send the typing notification to the server
        socket.emit('typing_event', {user: this.nickname || 'annoymous'})
      },

      selectedAvatar(event) {
        localStorage.setItem('selectedAvatar', event.target.parentElement.id);
      }
    },

    components: {
        newmsg: ChatMsg,
        newuser: UserBar
    }

  }).mount('#app')

  socket.addEventListener('connected', setUserID);
  socket.addEventListener('new_message', addNewMessage);
  socket.addEventListener('typing', handleTypingEvent);

