// imports go at the top
import ChatMsg from'./components/ChatMessage.js';
var socket = io();


// get username and room from URL
const { username, room} = Qs.parse(location.search.split('?')[1], {
  ignoreQueryPrefix: true
})



// utility function for socket
function setUserID({ sID }) {
  // save our unique ID generated by Socket on the server side
  vm.socketID = sID;
}

// utility functions for socket
function addNewMessage(message) {
    vm.messages.push(message);
}

function handleTypingEvent(user) {
  console.log(user,'is typing');
}

const { createApp } = Vue

const vm = createApp({

    data() {
      return {
        socketID: '',
        message: '',
        messages: [],
        nickname: '',
        avatar: localStorage.getItem('selectedAvatar')
      }
    },

    methods: {
      dispatchMessage() {
        console.log('send a message to the chat service');

        // data that sent to the server
        socket.emit('chat_message', { 
          content: this.message, 
          user: this.nickname || 'anonymous',
          id: this.socketID
        });

        this.message = '';
      },

      dispatchTypingEvent () {
        // send the typing notification to the server
        socket.emit('typing_event', {user: this.nickname || 'annoymous'})
      },

      selectedAvatar(event) {
        localStorage.setItem('selectedAvatar', event.target.parentElement.id);
      }
    },

    components: {
        newmsg: ChatMsg
    }

  }).mount('#app')

  socket.addEventListener('connected', setUserID);
  socket.addEventListener('new_message', addNewMessage);
  socket.addEventListener('typing', handleTypingEvent);